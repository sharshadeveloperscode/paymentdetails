
@{
    ViewBag.Title = "Reset Password";
    Layout = null;
}
<html>
<style>

/*Login Styles*/
.header{
   text-align:center;
   color:#3c8dbc;
}
.nav-tabs>li>a:hover {
    border-color: transparent !important;
}

.nav-tabs>li.active>a, .nav-tabs>li.active>a:focus, .nav-tabs>li.active>a:hover {
    background-color: transparent !important;   
}

 .login-form {
    width: 1500px;
    margin-left: 30px;
    
  }

  .login-title {
    font-family: 'Exo', sans-serif;
    text-align: center;
    color: white;
    margin-top: 13px;
    padding-bottom: 10px;
  }

  .login-userinput {
    margin-bottom: 10px;
  }

  .login-button {
    margin-top: 10px;
  }

  .login-options {
    margin-bottom: 0px;
  }

  .login-forgot {
    float: left;
  }


    </style>
<head>
    @*dropdown script*@
    <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
    <link href="http://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.0.3/css/bootstrap.min.css"
          rel="stylesheet" type="text/css" />
    <script type="text/javascript" src="http://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.0.3/js/bootstrap.min.js"></script>
    <link href="http://cdn.rawgit.com/davidstutz/bootstrap-multiselect/master/dist/css/bootstrap-multiselect.css"
          rel="stylesheet" type="text/css" />
    <script src="http://cdn.rawgit.com/davidstutz/bootstrap-multiselect/master/dist/js/bootstrap-multiselect.js"
            type="text/javascript"></script>
    <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
    @*calender script*@

    <link href="~/Content/libs/css/smoothness/jquery-ui-1.8.11.custom.css" rel="stylesheet" />
    <link rel='stylesheet' type='text/css' href='~/Content/jquery.weekcalendar.css' />
    <link href="~/Content/skins/default.css" rel="stylesheet" />
    <link href="~/Content/skins/gcalendar.css" rel="stylesheet" />

    <script src="~/Content/libs/jquery-1.4.4.min.js"></script>
    <script src="~/Content/libs/jquery-ui-1.8.11.custom.min.js"></script>
    <script src="~/Content/libs/jquery-ui-i18n.js"></script>
    <script src="~/Content/libs/date.js"></script>
    <script src="~/Content/jquery.weekcalendar.js"></script>

    <style>
     .multiselect {
         width: 200px;
     }

     .selectBox {
         position: relative;
     }

         .selectBox select {
             width: 100%;
             font-weight: bold;
         }

     .overSelect {
         position: absolute;
         left: 0;
         right: 0;
         top: 0;
         bottom: 0;
     }

     #checkboxes {
         display: none;
         border: 1px #dadada solid;
     }

         #checkboxes label {
             display: block;
         }

             #checkboxes label:hover {
                 background-color: #1e90ff;
             }
    </style>
    <style>
     /* The Modal (background) */
     .modal {
         display: none; /* Hidden by default */
         /*position: fixed;*/ /* Stay in place */
         z-index: 1; /* Sit on top */
         padding-top: 100px; /* Location of the box */
         left: 10px;
         top: 0;
         width: 100%; /* Full width */
         height: 100%; /* Full height */
         overflow: auto; /* Enable scroll if needed */
         background-color: rgb(0,0,0); /* Fallback color */
         background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
     }

     /* Modal Content */
     .modal-content {
         background-color: #fefefe;
         margin: auto;
         padding: 20px;
         border: 1px solid #888;
         width: 40%;
         height: 280px;
     }

     /* The Close Button */
     .close {
         color: #aaaaaa;
         float: right;
         font-size: 28px;
         font-weight: bold;
     }

         .close:hover,
         .close:focus {
             color: #000;
             text-decoration: none;
             cursor: pointer;
         }

     .wc-hour-header.ui-state-active, .wc-hour-header.ui-state-default {
         margin-top: 10px;
     }


     /* The Modal (background) */
     .modal3 {
         display: none;
         /*position: fixed;*/
         z-index: 1;
         padding-top: 100px;
         left: 0;
         top: 0;
         width: 100%;
         height: 100%;
         overflow: auto;
         background-color: rgb(0,0,0);
         background-color: rgba(0,0,0,0.4);
     }

     /* Modal Content */
     .modal-content3 {
         position: relative;
         background-color: #fefefe;
         margin: auto;
         padding: 0;
         border: 1px solid #888;
         width: 80%;
         height: 175px;
     }




     /* The Close Button */
     .close3 {
         color: white;
         float: right;
         font-size: 28px;
         font-weight: bold;
         margin-top: -18px;
         margin-right: 10px;
     }

         .close3:hover,
         .close3:focus {
             color: #fff;
             text-decoration: none;
             cursor: pointer;
         }

     .modal-header3 {
         padding: 20px 16px;
         background-color: #3c8dbc;
         color: white;
     }

     .modal-body3 {
         padding: 2px 16px;
     }

     .modal-footer3 {
         padding: 19px 20px 20px;
         margin-top: 15px;
         text-align: right;
     }
    </style>
</head>

</html>
<body>
    <section class="content" style="width:1000px;align-content:center">
        <div class="row" >
            <div class="col-xs-12" style="text-align:center">
                <div class="box">
                    <!-- /.box-header -->
                    <div class="box-body table-responsive" style="padding:0px">
                        <div id="dvErrorStatus" style="display:none" class="alert alert-danger alert-dismissible">
                            <button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>
                            <lable id="lblSettings"></lable>
                        </div>
                        <div id="dvSuccess" style="display:none" class="alert alert-success alert-dismissible">
                            <button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>
                           
                        </div>
                    </div>
                    @*<div class="box-body">
                        <div class="box-body" style="margin-left:242px;padding:168px">
                            <table style="width: 100%" class="table table-bordered table-hover dataTable">
                                <h4 style="margin-right:-1px; padding: 10px; background-color:#4b8df8; color:white; height: 40px">
                                    <i class="fa fa-lock"></i>
                                    <lable>
                                        Reset Password
                                    </lable>
                                </h4>
                              
                                <tr >
                                    <td>
                                        <lable>New Password<span style="color:red;">*</span></lable>
                                    </td>
                                    <td>
                                        <input type="password" maxlength="40" style="width:180px"  id="txtNewPassword" placeholder="Enter New Password" name="txtNewPassword" title="Enter Alphabets only" pattern="^[a-zA-Z]*$" class="form-control" required />
                                    </td>
                                </tr>
                                <tr>
                                    <td style="max-width:48px;">
                                        <lable>Confirm New Password<span style="color:red;">*</span></lable>
                                    </td>
                                    <td>
                                        <input type="password" maxlength="40" style="width:182px" id="txtConfirmNewPassword" placeholder="Enter Confirm  Password" name="txtConfirmNewPassword" title="Enter Alphabets only" pattern="^[a-zA-Z]*$" class="form-control" required />
                                    </td>
                                </tr>
                                <tr>
                                    <td colspan="2" style="text-align:right">
                                        <input type="button" class="btn btn-primary" id="btnSubmit" value="Change Password" style="width:145px;" onclick="ChangePassword()" />
                                        <input type="button" class="btn btn-danger" id="btnReset" value="Reset" onclick="Clear()" style="width:100px;" />
                                        <label style="color:red" id="lb1message"></label>
                                        <label style="color:green" id="lb1message1"></label>
                                      
                                    </td>
                                </tr>
                                <lable style="color:green" id="lbl_status"></lable>
                            </table>
                        </div>
                    </div>*@
                    <div class="container" style="margin-top:100px">
                        <div class="row">                       
                            <div class="col-md-4 col-md-offset-4">
                                <div class="login_bg" style="box-shadow: 0 2px 5px 0 rgba(0,0,0,.16), 0 2px 10px 0 rgba(0,0,0,0); border: 1px solid #ddd; ">
                                    <h3 class="login-title" style="font-size:20px;color:#333;font-weight:600"> Reset Password</h3>
                                </div>

                                <div class="panel panel-default" style="margin-top:-10px;border-radius: 0px; box-shadow: 0 2px 5px 0 rgba(0,0,0,.16), 0 2px 10px 0 rgba(0,0,0,0); border:1px solid #ddd;">
                                    <div class="panel-body">
                                        <form>
                                            <div class="form-group">
                                                <lable>New Password<span style="color:red;">*</span></lable>
                                                <div class="input-group">
                                                    <span class="input-group-addon">
                                                        <i class="glyphicon glyphicon-user"></i>
                                                    </span>
                                                    <input type="text" name="txtUserName" id="txtUserName" class="form-control" placeholder="Enter Username" />
                                                </div>
                                                <label id="lblUserName" style="display:none;"></label>
                                            </div>
                                            <div class="form-group">
                                                <div class="input-group">
                                                    <span class="input-group-addon">
                                                        <i class="glyphicon glyphicon-lock"></i>
                                                    </span>
                                                    <input type="password" name="txtPassword" id="txtPassword" class="form-control" placeholder="Enter Password" />

                                                </div>
                                            </div>
                                            <label id="lblPassword" style="display:none;"></label>
                                            <div class="form-group login-group-checkbox">
                                                <div class="row" style="margin-left:0px;margin-top:12px;">
                                                    <input type="checkbox" class="" id="reg_agree" name="reg_agree">
                                                    <label for="reg_agree"><a href="#" data-toggle="modal" data-target="#modal-forgot_password" style="">Forgot Password?</a></label>
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="col-xs-6 col-sm-6 col-md-6">
                                                    <button onclick="Login()" id="btnSignin" type="button" class="btn btn-success" style="width:100%">Sign  in</button>
                                                </div>
                                                <div class="col-xs-6 col-sm-6 col-md-6">
                                                    <button onclick="location.href='http://hogarbarber.developerscode.in/'" id="btnBack" type="submit" style="width:100%" class="btn btn-danger">Back</button>
                                                </div>
                                            </div>
                                            <label id="lbl_status"></label>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>



                </div>
            </div>
        </div>
    </section>
</body>

<script type="text/javascript">
    var URL = "@System.Configuration.ConfigurationManager.AppSettings["URL"]";
   // Permissions();
    var UserId = localStorage.getItem("UserId");

    window.onload=function()
    {
        window.history.forward();
        var getUrlParameter = function getUrlParameter(sParam) {
            var sPageURL = decodeURIComponent(window.location.search.substring(1)),
                sURLVariables = sPageURL.split('&'),
                sParameterName,
                i;

            for (i = 0; i < sURLVariables.length; i++) {
                sParameterName = sURLVariables[i].split('=');

                if (sParameterName[0] === sParam) {
                    return sParameterName[1] === undefined ? true : sParameterName[1];
                }
            }
        };

        var email = getUrlParameter('liamdmc');

        email = email.replace("!123", "@@");
        email = email.replace("567", ".com");
        email = email.replace("liam", "mail");
        localStorage.setItem("UserEmailId", email);
    }

    function Clear()
    {

        $("#txtNewPassword").val("");
        $("#txtConfirmNewPassword").val("");
        $("#dvErrorStatus").css({ display: "none" });
        $("#dvSuccess").css({ display: "none" });
        $("#lbl_status").text("");
    }
    GetAdminEmail();


    function GetAdminEmail() {

        var iddd = localStorage.getItem("UserEmailId");

        $.ajax({
            type: 'GET',
            url: URL + "api/Users/GetUserIdByEmail",
            data: { "Email": iddd },
            contentType: 'application/x-www-form-urlencoded; charset=utf-8',
            xhrFields: {
                withCredentials: false
            },
            success: function (json) {
                //  alert(json[0].AdminName);UserId
                localStorage.setItem("UserId", json[0].UserId);
                localStorage.setItem("AdminEmail", json[0].Email);
                localStorage.setItem("AdminMobileNumber", json[0].MobileNumber);
                localStorage.setItem("AdminName", json[0].UserName);
            },
            error: function (err) {
                console.log(err.StatusText);
            }
        });
    }
    function ChangePassword()
    {

        var UserId = localStorage.getItem("UserId");
        var AdminEmail = localStorage.getItem("AdminEmail");
        var AdminName = localStorage.getItem("AdminName");
        var MobileNumber = localStorage.getItem("AdminMobileNumber");
        var Content = "Thank you Your Login Details Updated Successfullly. <br/> Your Salon Login Credentials are :<br/><br/> UserName : " + AdminName + " <br/> Password :" + $('#txtConfirmNewPassword').val() + " ";

        if ($("#txtNewPassword").val() != '' && $("#txtConfirmNewPassword").val() != '' &&  $("#txtNewPassword").val() == $("#txtConfirmNewPassword").val())
        {

        $.ajax({
            url: URL + "api/Users/Change_Password?Password=" + $("#txtConfirmNewPassword").val() + "&UserId=" + UserId + "",
            type: "GET",
            cache: false,
            success: function (r) {

                if (r[0].Message = "Success")
                {
                    $("#dvErrorStatus").css({ display: "none" });
                 //   $("#dvSuccess").css({ display: "block" });
                    $("#lbl_status").text("Password Changed Successfully");
                    localStorage.setItem("Password", $("#txtConfirmNewPassword").val());
                    $("#txtConfirmNewPassword").val("");
                    $("#txtNewPassword").val("");
                   // alert("Password Reset Successfull");
                    setTimeout(function () { window.location.href = '@Url.Action("Login", "Salon")'; }, 3000);


                }
                else if (r[0].Message = "Error") {
                    $("#dvErrorStatus").css({ display: "block" });
                    $("#dvSuccess").css({ display: "none" });
                    $("#lbl_status").text(r[0].Error);
                }

            },
            error: function (err) {
                alert(err.statusCode + "  " + err.statusText);
            }
        })

    }
    else
    {
            if($("#txtNewPassword").val() == '')
            {
                alert("please enter New Password");

                $("#txtNewPassword").focus();
            }
            else if($("#txtConfirmNewPassword").val() =='')
            {
                alert("please enter Confirm New Password")
                $("#txtConfirmNewPassword").focus();
            }
            else if ( $("#txtNewPassword").val() != $("#txtConfirmNewPassword").val())
            {
                alert("Password Does not match");
            }
    }


    }
</script>
