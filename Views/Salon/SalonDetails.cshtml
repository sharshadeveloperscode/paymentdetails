
@{
    ViewBag.Title = "SalonDetails";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<style>
    .form-control {
        width: 300px !important;
    }
</style>
<link href="http://cdnjs.cloudflare.com/ajax/libs/summernote/0.8.9/summernote.css" rel="stylesheet">
<script src="http://cdnjs.cloudflare.com/ajax/libs/summernote/0.8.9/summernote.js"></script>

<section class="content-header">
    <h1>
        Salon Details
    </h1>
    <ol class="breadcrumb">
        <li><a href="#"><i class="fa fa-dashboard"></i>Home</a></li>
        <li><a href="#">Salon</a></li>
        <li><a href="#">Salon Details</a></li>

    </ol>
</section>

<section class="content">
    <div class="row">
        <div class="col-xs-12">
            <div class="box">
                <!-- /.box-header -->
                <div class="box-body table-responsive">
                    <div id="dvErrorStatus" style="display:none" class="alert alert-danger alert-dismissible">
                        <button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>
                        <label id="lblSalon"></label>
                    </div>
                    <div id="dvSuccess" style="display:none" class="alert alert-success alert-dismissible">
                        <button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>
                        <label id="lbl_status"></label>
                    </div>
                </div>
                <div class="box-body table-responsive">
                    <table style="width: 100%" class="table table-bordered table-hover dataTable">
                        <tr><td colspan="4"><label style="color:red;margin-left: 1%;">* indicates fields are required</label></td></tr>
                        <tr>
                            <td>
                                Display Image:<label style="color:red;margin-left: 1%;"></label>
                            </td>
                            <td>
                                <input type="file" id="FileUpload" name="FileUpload" onchange="readURL(this);" title="Select File" required class="form-control" />Select File
                                <label style="color:red;margin-left: 1%;"> *</label>
                                <label id="lblFile"></label>
                            </td>
                            <td colspan="2">
                                <div id="divProfileImage" style="display:none">

                                </div>
                                <img id="ImgEmployeeProfile" style="display:none; width: 212px; height: 165px;" />
                            </td>
                        </tr>
                        <tr>
                            <td>
                                Website:<label style="color:red;margin-left: 1%;"></label>
                            </td>
                            <td>
                                <input type="text" placeholder="Enter WebSite" id="txtWebSite" name="txtWebSite" class="form-control" required />
                            </td>
                            <td colspan="2"></td>
                        </tr>
                        <tr>
                            <td>
                                Salon Name:<label style="color:red;margin-left: 1%;">*</label>
                            </td>
                            <td>
                                <input type="text" placeholder="Enter First Name" id="txtBusinessName" name="txtBusinessName" title="Enter Alphabets only" class="form-control" required />
                            </td>
                            <td>
                                Business Type:<label style="color:red;margin-left: 1%;">*</label>
                            </td>
                            <td>
                                <select type="text" required="required" name="ddlBusinessType" id="ddlBusinessType" class="form-control">
                                    <option value="0">Select Business Type</option>

                                </select>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                Email:<label style="color:red;margin-left: 1%;">*</label>
                            </td>
                            <td>
                                <input type="text" placeholder="Enter Email" id="txtEmail" name="txtEmail" title="Enter Alphabets only" class="form-control" required />
                            </td>
                            <td>
                                Name:<label style="color:red;margin-left: 1%;">*</label>
                            </td>
                            <td>
                                <input type="text" placeholder="Enter Name" id="txtName" name="txtName" title="Enter Alphabets only" class="form-control" required />
                            </td>
                        </tr>
                        <tr>
                            <td>
                                Password:<label style="color:red;margin-left: 1%;">*</label>
                            </td>
                            <td>
                                <input type="password" placeholder="Enter Password" id="txtPassword" name="txtPassword" title="Enter Alphabets only" class="form-control" required />
                            </td>
                            <td>
                                Classes:<label style="color:red;margin-left: 1%;">*</label>
                            </td>
                            <td>
                                <select type="text" required="required" name="" id="ddlClasses" class="form-control">
                                    <option value="0">Select</option>
                                </select>
                                <select type="text" required="required" name="" style="display:none;" id="ddlCountry" class="form-control">
                                    <option value="1">India</option>
                                </select>
                            </td>
                            @*<td>
                                    Country:<label style="color:red;margin-left: 1%;"></label>
                                </td>
                                <td>
                                    <select type="text" required="required" name="" id="ddlCountry" class="form-control">
                                        <option value="1">UK</option>

                                    </select>
                                </td>*@
                        </tr>
                        <tr>
                            <td>
                                Phone Number:<label style="color:red;margin-left: 1%;">*</label>
                            </td>
                            <td>
                                <input type="text" placeholder="Enter Phone Number" id="txtPhoneNo" name="txtPhoneNo" title="Enter Alphabets only" class="form-control" required />
                            </td>
                            <td>
                                Address:<label style="color:red;margin-left: 1%;"></label>
                            </td>
                            <td>
                                <textarea type="text" id="txtAddress" name="txtAddress" title="Enter Alphabets only" class="form-control"></textarea>
                            </td>
                        </tr>

                        <tr>
                            <td>
                                Postal Code:<label style="color:red;margin-left: 1%;">*</label>
                            </td>
                            <td>
                                <input type="text" placeholder="Enter Postal Code" id="txtPostalcode" name="txtPostalcode" title="Enter Alphabets only" class="form-control" required />
                            </td>
                            <td>
                                City:<label style="color:red;margin-left: 1%;">*</label>
                            </td>
                            <td>
                                <select type="text" required="required" name="" id="ddlCity" onchange="Area()" class="form-control">
                                    <option value="0">--Select one--</option>

                                </select>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                Area:<label style="color:red;margin-left: 1%;">*</label>
                            </td>
                            <td>
                                <select type="text" required="required" name="" id="ddlArea" class="form-control">
                                    <option value="0">--Select one--</option>

                                </select>
                            </td>
                            <td>
                                Popularity:<label style="color:red;margin-left: 1%;"></label>
                            </td>
                            <td>
                                <select type="text" required="required" id="ddlPopularity" class="form-control">
                                    <option value="1">1</option>
                                    <option value="2">2</option>
                                    <option value="3">3</option>
                                    <option value="4">4</option>
                                    <option value="5">5</option>
                                </select>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                No. of chairs:<label style="color:red;margin-left: 1%;">*</label>
                            </td>
                            <td>
                                <input type="number" min="1" placeholder="Enter No. of chairs" id="txtNoofchairs" name="txtNoofchairs" title="Enter Numeric only" class="form-control" onkeypress="GetAvailability()" onchange="GetAvailability()" required />
                                <input type="hidden" id="txtNoofchairshidden" />
                                <input type="hidden" id="txtbookedchairs" />
                                <label id="lblAvailableStatus" style="color:red;"></label>
                            </td>
                            <td>
                                Available Chairs:<label style="color:red;margin-left: 1%;"></label>
                            </td>
                            <td>
                                <label id="lblAvailable"></label>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                Description:<label style="color:red;margin-left: 1%;"></label>
                            </td>
                            <td colspan="3">
                                <textarea type="text" placeholder="Enter Note" id="txtNote" name="txtNote" title="Enter Alphabets only" class="form-control"></textarea>
                            </td>
                        </tr>
                        <tr>
                            <td colspan="4" style="text-align:right">
                                <input type="button" class="btn btn-primary" id="btnSave" value="Save" style="width:100px;" onclick="Save()" />
                                <input type="button" class="btn btn-danger" id="btnReset" value="Reset" onclick="Clear()" style="width:100px;" />
                                <input type="text" hidden="hidden" id="txtSalonsId" name="txtSalonsId" />
                            </td>
                        </tr>
                    </table>
                    <label id="lbl_status"></label>
                </div>
                <div class="box-body ">
                    <div class="pull-left">
                        <input type="button" id="btnDocs" class="btn btn-success" style="" value="Add Images" onclick="AddDocument()" /><br />
                    </div>
                    <table style="width: 100%" id="tblTender" class="table  table-hover dataTable"></table>
                    <div id="divTender" class="col-lg-12">
                    </div>
                    <div style="text-align:right">
                        <input type="button" class="btn btn-primary" id="btnImageSave" value="Update" style="width:100px;margin-top:10px" onclick="Save()" />
                        <input type="button" class="btn btn-danger" id="btnReset" value="Reset" onclick="Clear()" style="width:100px;margin-top:10px;display:none">
                        <input type="button" class="btn btn-danger" id="btnEdit" value="Back" style="width:100px;margin-top:10px;" onclick="window.location.href='@Url.Action("BusinessDashboard", "Salon")';" />
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div id="preloader" style="position: absolute; top: 0; left: 0; right: 0; bottom: 0; background-color: #fefefe; z-index: 99; height: 110vh;">
        <div id="status" style="width:100%;height:100%; text-align: center; position: absolute; left: 0; top: 30%; background-repeat: no-repeat; background-size: cover cover; background-position: center; margin: 0px 0 0 36px;">
            <div class="preloader-logo"></div>
            <p class="center-text smaller-text" id="p1" style="margin: 0 24px 10px !important;">
                <h2> Loading .. </h2><br />
                <img src="~/img/preload.gif" />
            </p>
        </div>
    </div>
</section>
<script type="text/javascript">
    var URL = "@System.Configuration.ConfigurationManager.AppSettings["URL"]";
    var UserId = localStorage.getItem("UserId");
    var RoleId = localStorage.getItem("RoleId");
    var count = 0;
    window.onload = function () {
        $('#preloader').hide();
    }

    $(document).ready(function () {
        $('#txtNote').summernote({
            height: 300
        });
    });

    City();
    BusinessType();
    BindSalons();
    $('#btnEdit').show();
    $('#btnReset').hide();
    $('#btnSave').hide();
    var DocArr = [];
    var Docmnt = [];
    var DocmntPath = [];
    var arrImg = [];
    function readURL(input) {
        $("#divProfileImage").css({ display: "none" });
        if (input.files && input.files[0]) {
            var reader = new FileReader();
            reader.onload = function (e) {

                $('#ImgEmployeeProfile').show();
                $('#ImgEmployeeProfile').attr('src', e.target.result);
            };
            reader.readAsDataURL(input.files[0]);
        }
    }
    function MemberType() {
        $.ajax({
            type: 'GET',
            url: URL + "api/MemberType/GetdataByIsActive",
            contentType: 'application/x-www-form-urlencoded; charset=utf-8',
            xhrFields: {
                withCredentials: false
            },
            success: function (data) {
                $('#ddlMemberType').empty();
                for (var i = 0; i < data.length; i++) {
                    var opt = new Option(data[i].MemberTypeName, data[i].MemberTypeId);
                    $("#ddlMemberType").val("");
                    $('#ddlMemberType').append(opt);
                }
            },
            error: function (err) {
                console.log(err.StatusText);
            }
        });
    }
    function Save() {
        Update();
        for (var r = 0; r < DocArr.length; r++) {
            var data = new FormData();
            var files = $("#txtfile" + DocArr[r]).get(0).files;
            if (files.length > 0) {
                data.append("MyImages", files[0]);
                $.ajax({
                    url: WebURL + "Upload/UploadSalonImages",
                    type: "POST",
                    processData: false,
                    contentType: false,
                    data: data,
                    success: function (response) {
                        var FilePath = WebURL + "Files/SalonImages/" + response;
                        $.ajax({
                            url: URL + "api/SalonImage/Insert?Image=" + response + "&ImagePath=" + FilePath + "&SalonsId=" + $('#txtSalonsId').val() + "&IsAcitve=1&CreatedBy=" + UserId + "",
                            type: "GET",
                            cache: false,
                            success: function (r) {
                                if (r[0].Message == "Error") {
                                    $("#dvErrorStatus").css({ display: "block" });
                                    $('#lblSalon').text(r[0].ErrorMessage);
                                }
                                else {
                                    BindSalons();
                                    $("#dvErrorStatus").css({ display: "none" });
                                }
                            },
                            error: function (err) {
                                $("#dvErrorStatus").css({ display: "block" });
                                $('#lblTenderCreation').text(err.statusText);
                            }
                        });
                    },
                    error: function (XMLHttpRequest, textStatus, errorThrown) {
                        console.log(textStatus + ': ' + errorThrown);
                    }
                });
            }
        }
        DocArr = [];
    }

    function readURLS(input, countt) {
        if (input.files && input.files[0]) {
            var reader = new FileReader();
            reader.onload = function (e) {
                $('#ImgEmployeeProfile1' + countt).show();
                $('#ImgEmployeeProfile1' + countt).attr('src', e.target.result);
            };
            reader.readAsDataURL(input.files[0]);
        }
    }
    var tr = 0;
    function AddDocument() {
        $("#btnImageSave").show();
        var tab = '<div class="col-md-3" id="Remove' + count + '" >'
        tab += "<input type='file' onchange='readURLS(this ," + count + ");' name='file" + count + "' id='txtfile" + count + "' style='width:220px'/>" +
        "<label id='documentName'  style='display:none'></label>" +
             "<img id='ImgEmployeeProfile1" + count + "'  style='width: 212px; height: 165px;' />" +
         "<input class='btn btn-danger' type='button'  onclick='DeleteFile(" + count + ")'value='Remove' style='height: 25px;padding-top:1px;margin-top:2px;margin-left: 60%;' />";
        tab += '</div>';
        $('#divTender').append(tab);
        DocArr.push(count);
        count++;
    }


    function DeleteFile(i) {
        if (confirm("Are you sure you want to remove this image") == true) {
            $("#Remove" + i).remove();
            $("#Remove" + i).removeClass('col-md-3');
            var index = DocArr.indexOf(i);
            if (index >= 0) {
                DocArr.splice(index, 1);
            }
        } else { }
    }


    function Delete(id, name) {
        if (confirm("Are you sure to delete '" + name + "'") == true) {
            $.ajax({
                url: URL + "api/TenderDocuments/DeleteDocument?DocumentId=" + id,
                type: "GET",
                cache: false,
                success: function (data) {
                    if (data[0].Message == "Error") {
                        $("#dvSuccess").css({ display: "none" });
                        $("#dvErrorStatus").css({ display: "block" });
                        $('#lblTenderCreation').text(err.statusText);
                    }
                    else if (data[0].Message == "Success") {
                        $.ajax({
                            url: WebURL + "Upload/DeleteDocument?DocName=" + name,
                            type: "POST",
                            processData: false,
                            contentType: false,
                            data: data,
                            success: function (response) {
                                if (response == "Success") {
                                    alert("Deleted Successfully");
                                }
                            },
                            error: function (err) {
                                $("#dvErrorStatus").css({ display: "block" });
                                $('#lblRole').text(err.statusText);
                            }
                        })
                    }
                    BindData(localStorage.getItem("EditTenderCreationId"));
                },
                error: function (err) {
                    $("#dvErrorStatus").css({ display: "block" });
                    $('#lblRole').text(err.statusText);
                }
            })
        }
    }
    function City() {
        $.ajax({
            type: 'GET',
            url: URL + "api/City/GetdataByIsActive",
            contentType: 'application/x-www-form-urlencoded; charset=utf-8',
            xhrFields: {
                withCredentials: false
            },
            success: function (data) {
                $('#ddlCity').empty();
                for (var i = 0; i < data.length; i++) {
                    var opt = new Option(data[i].CityName, data[i].CityId);
                    $("#ddlCity").val("");
                    $('#ddlCity').append(opt);
                }
            },
            error: function (err) {
                console.log(err.StatusText);
            }
        });
    }
    function BusinessType() {
        $.ajax({
            type: 'GET',
            url: URL + "api/Category/GetCategoryByIsActive",
            contentType: 'application/x-www-form-urlencoded; charset=utf-8',
            xhrFields: {
                withCredentials: false
            },
            success: function (data) {
                $('#ddlBusinessType').empty();
                for (var i = 0; i < data.length; i++) {
                    var opt = new Option(data[i].Category, data[i].CategoryId);
                    $("#ddlBusinessType").val("");
                    $('#ddlBusinessType').append(opt);
                }
            },
            error: function (err) {
                console.log(err.StatusText);
            }
        });
    }

    function Area() {
        $.ajax({
            type: 'GET',
            url: URL + "api/Area/GetDatabyCityIdByIsActive?CityId=" + $("#ddlCity").val(),
            contentType: 'application/x-www-form-urlencoded; charset=utf-8',
            xhrFields: {
                withCredentials: false
            },
            success: function (data) {
                $('#ddlArea').empty();
                for (var i = 0; i < data.length; i++) {
                    var opt = new Option(data[i].AreaName, data[i].AreaId);
                    $("#ddlArea").val("");
                    $('#ddlArea').append(opt);
                }
            },
            error: function (err) {
                console.log(err.StatusText);
            }
        });
    }

    function AreaLoad(CityId, AreaId) {
        $.ajax({
            type: 'GET',
            url: URL + "api/Area/GetDatabyCityIdByIsActive?CityId=" + CityId,
            contentType: 'application/x-www-form-urlencoded; charset=utf-8',
            xhrFields: {
                withCredentials: false
            },
            success: function (data) {
                $("#ddlArea").empty("");
                for (var i = 0; i < data.length; i++) {
                    var opt = new Option(data[i].AreaName, data[i].AreaId);
                    $("#ddlArea").val("");
                    $('#ddlArea').append(opt);
                }
                $('#ddlArea').val(AreaId);
            },
            error: function (err) {
                console.log(err.StatusText);
            }
        });
    }
    function CityLoad(CityId) {
        $.ajax({
            type: 'GET',
            url: URL + "api/City/GetdataByIsActive",
            contentType: 'application/x-www-form-urlencoded; charset=utf-8',
            xhrFields: {
                withCredentials: false
            },
            success: function (data) {
                $('#ddlCity').empty();
                for (var i = 0; i < data.length; i++) {
                    var opt = new Option(data[i].CityName, data[i].CityId);
                    $("#ddlCity").val("");
                    $('#ddlCity').append(opt);
                }
                $("#ddlCity").val(CityId);
            },
            error: function (err) {
                console.log(err.StatusText);
            }

        });
    }
    function BusineeTypeLoad(TypeId) {
        $.ajax({
            type: 'GET',
            url: URL + "api/Category/GetCategoryByIsActive",
            contentType: 'application/x-www-form-urlencoded; charset=utf-8',
            xhrFields: {
                withCredentials: false
            },
            success: function (data) {
                $('#ddlBusinessType').empty();
                for (var i = 0; i < data.length; i++) {
                    var opt = new Option(data[i].Category, data[i].CategoryId);
                    $("#ddlBusinessType").val("");
                    $('#ddlBusinessType').append(opt);
                }
                $('#ddlBusinessType').val(TypeId);
            },
            error: function (err) {
                console.log(err.StatusText);
            }
        });
    }
    function Clear() {

        $("#txtPostalcode").val("");
        $("#txtCustomerId").val("");
        $("#txtBusinessName").val("");
        $("#txtAddress").val("");
        $("#txtName").val("");
        $("#txtPhoneNo").val("");

        $("#txtEmail").val("");
        $("#txtNote").val("");
        $("#txtPassword").val("");
        $("#ddlMemberType").val("");
        $("#ddlCountry").val("");
        $("#ddlCity").val("");
        //  $("#ddlArea").val(r[0].AreaId);
        $("#ddlbookings").val("");
        $("#ddlSigining").val("");
        $("#lbl_status").text("");
        $("#lblSalon").text(" ");
        $('#btnEdit').hide();
        // $('#btnSave').show();
        $("#dvSuccess").css({ display: "none" });
        $("#dvErrorStatus").css({ display: "none" });
        $("#ImgEmployeeProfile").empty();
        $("#ImgEmployeeProfile").css({ display: "none" });
        localStorage.setItem("EployeeProfileImage", 'null');
        localStorage.setItem("EployeeProfileImage", 'null');
        $("#divProfileImage").empty();
        $("#divProfileImage").css({ display: "none" });

    }

    function BindSalons() {
        var UserId = localStorage.getItem("UserId");
        Clear();
        //  RolesLoad();
        $("#lbl_status").text("");

        $('#btnEdit').show();
        $('#btnSave').hide();

        $.ajax({
            url: URL + "api/Salons/GetByUserId?UserId=" + UserId,
            type: "GET",
            cache: false,
            async: false,
            success: function (r) {

                $('#txtSalonsId').val(r[0].SalonsId);
                $("#txtPostalcode").val(r[0].PostalCode);
                $("#txtCustomerId").val(r[0].SalonsId);
                $("#txtBusinessName").val(r[0].BusinessName);
                $("#txtWebSite").val(r[0].Website);
                $("#txtAddress").val(r[0].Address);
                $("#txtName").val(r[0].Name);
                $("#txtPhoneNo").val(r[0].PhoneNumber);
                GetClassesLoad(r[0].ClassId);
                //  $("#ddlBusinessType").val(r[0].BusinessType);
                // $("#ddlBusinessType").val(r[0].BusinessTypeId);
                $("#ddlbookings").val(r[0].BookingsName);
                $("#txtEmail").val(r[0].Email);
                $('#ddlPopularity').val(r[0].Popularity);
                setTimeout(function () {
                    $('#txtNote').summernote('code', r[0].Note);
                }, 2000);

                $("#txtPassword").val(r[0].Password);
                $("#ddlMemberType").val(r[0].MemberTypeName);
                $("#ddlCountry").val(r[0].CountryId);
                $("#ddlCity").val(r[0].CityId);
                $('#preloader').hide();

                $("#txtNoofchairs").val(r[0].Noofchairs);
                $("#txtNoofchairshidden").val(r[0].Noofchairs);
                $('#txtbookedchairs').val(r[0].chairs);
                $("#lblAvailable").text(r[0].Available);
                //  $("#preloader").show();
                setTimeout(function () {
                    BusineeTypeLoad(r[0].BusinessType);
                    CityLoad(r[0].CityId);
                    AreaLoad(r[0].CityId, r[0].AreaId);
                }, 1000);

                //  $("#ddlArea").val(r[0].AreaId);
                $("#ddlbookings").val(r[0].ManageYourBookings);
                $("#ddlSigining").val(r[0].ReasonForSigningUp);

                localStorage.setItem("EployeeProfileImage", r[0].ImagePath);
                localStorage.setItem("Image", r[0].Image);

                $("#divProfileImage").css({ display: "block" });
                $('#divProfileImage').append("<image  src='" + r[0].ImagePath + "' height='150px' width='150px'/>");

                BindSalonImages();
            },
            error: function (err) {
                $("#dvErrorStatus").css({ display: "block" });
                $('#lblSalon').text(err.statusText);
            }
        })
    }
    function imgError(image) {
        image.onerror = "";
        image.src = "/img/Puppy.jpg";
        return true;
    }

    function BindSalonImages() {

        $.ajax({
            url: URL + "api/SalonImage/GetDatabySalonId?SalonId=" + $('#txtSalonsId').val(),
            type: "GET",
            cache: false,
            async: false,
            success: function (r) {
                if (r[0].Message == "Success") {
                    $('#tblTender').empty();
                    // if (r.length == 1) {


                    //   }

                    //    else {
                    $('#divTender').text("");
                    for (var M = 0 ; M < r.length ; M++) {


                        var tab = '<div class="col-md-3" id="DeleteImage' + count + '">'



                        tab += "<img id='BindImg" + M + "'  style='width: 212px; height: 165px;' src='" + r[M].ImagePath + "'/>" +
                                 "<input class='btn btn-danger' type='button'  onclick='DeleteImages(" + count + "," + r[M].SalonImageId + ")' value='Remove' style='height:25px;padding-top:1px;margin-top:2px;margin-left: 60%;' />";
                        tab += '</div>'
                        //tab = "<tr id='DeleteImage" + M + "'><td></td><td>" +
                        //      "<img id='BindImg" + M + "'  style='width: 212px; height: 165px;' src='" + r[M].ImagePath + "'/>" +
                        //    //  "<span style='margin-top:-21px;color:red;cursor:pointer' onclick='DeleteImages(" + M + "," + r[M].SalonImageId + ")'><i class='fa fa-times'></i></span>" +
                        //        "<a href='#'  onclick='DeleteImages(" + M + "," + r[M].SalonImageId + ")'>Remove</a>"+
                        //      "</td></tr>";
                        $('#divTender').append(tab);
                        //
                        count++;
                    }

                    // }


                }
                else if (r[0].Message == "NoData") {

                    $('#tblTender').empty();
                    if (r.length == 1) {


                    }

                    else {
                        var tab = '';
                        for (var M = 0 ; M < r.length ; M++) {

                            tab = "<tr id='DeleteImage" + M + "'><td></td><td>" +
                                  "<img id='BindImg" + M + "'  style='width: 212px; height: 165px;' src='" + r[M].ImagePath + "'/>" +
                                    "<a href='javascript:void(0)'  onclick='DeleteImages(" + M + "," + r[M].SalonImageId + ")'>Remove</a>" +
                                  "</td></tr>";
                            $('#tblTender').append(tab);

                        }

                    }
                }

            },
            error: function (err) {
                $("#dvErrorStatus").css({ display: "block" });
                $('#lblSalon').text(err.statusText);
            }
        })


    }

    function DeleteImages(M, SalonImageId) {


        if (confirm("Are you sure you want to remove this image") == true) {


            $.ajax({
                url: URL + "api/SalonImage/Delete",
                data: { "SalonImageId": SalonImageId },
                type: "GET",
                cache: false,
                dataType: 'json',
                contentType: 'application/x-www-form-urlencoded; charset=utf-8',
                success: function (r) {

                    $("#DeleteImage" + M).text("");
                    $("#DeleteImage" + M).removeClass('col-md-3');
                    var index = DocArr.indexOf(M);
                    if (index >= 0) {
                        DocArr.splice(index, 1);
                    }
                    if (r[0].Message == "REFERENCE") {
                        $("#dvSuccess").css({ display: "none" });
                        $("#dvErrorStatus").css({ display: "block" });
                        $("#lblArea").text("Sorry! Can't Delete This Record. It Is Existed In Another Table");
                    }
                    else if (r[0].Message == "Error") {
                        $('#tblArea').hide();
                        $("#dvErrorStatus").css({ display: "block" });
                        $('#lblArea').text(r[0].ErrorMessage);
                    }
                    else if (r[0].Message = "Success") {
                        $("#dvErrorStatus").css({ display: "none" });
                        // $("#dvSuccess").css({ display: "block" });
                        $("#lbl_status").text(" Deleted Successfully");
                    }
                },
                error: function (err) {
                    $("#dvErrorStatus").css({ display: "block" });
                    $('#lblArea').text(err.StatusText);
                }
            });


        } else { }
    }


    function Update() {
        $("#lbl_status").text("");
        if ($("#txtBusinessName").val() != "" && $("#txtEmail").val() != "" && $('#txtPassword').val() != '' && $('#txtName').val() && $('#ddlCity').val() != 0 && $('#ddlClasses').val() != 0 && $('#ddlbookings').val() != 0 && $('#ddlSigining').val() != 0 && $('#txtNoofchairs').val() != "") {
            var Name = $("#txtName").val();
            var UpdatedBy = UserId;

            var filter = new RegExp(/^[+a-zA-Z0-9._-]+@@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,4}$/i);
            var email = $("#txtEmail").val();
            if (!filter.test(email)) {
                $("#dvSuccess").css({ display: "none" });
                $("#dvErrorStatus").css({ display: "block" });
                $("#lbl_status").text("Please Enter Valid Email");

            } else {

                if ($("#FileUpload").val() != '') {
                    var data = new FormData();
                    var files = $("#FileUpload").get(0).files;
                    if (files.length > 0) {
                        data.append("MyImages", files[0]);
                    }
                    $.ajax({
                        url: WebURL + "Upload/SaveSalonDisplayImages",
                        type: "POST",
                        processData: false,
                        contentType: false,
                        data: data,
                        success: function (response) {
                            console.log("response");

                            console.log(response);
                            var FilePath = WebURL + "Files/SalonDisplayImages/" + response;
                            //if ($("#frontendStatus").is(':checked')) {
                            //    var i = 1;
                            //}
                            //else if (!$("#frontendStatus").is(':checked')) {
                            //    var i = 0;
                            //}
                            var Content = "Your Salon as Updated. <br/> Your Salon Login Credentials are :<br/><br/> UserName : " + $('#txtEmail').val() + " <br/> Password :" + $('#txtPassword').val() + " ";
                            $.ajax({
                                url: URL + "api/Salons/UpdateSalons",
                                data: { "BusinessName": $("#txtBusinessName").val(), "Address": $("#txtAddress").val(), "Name": $("#txtName").val(), "PostalCode": $("#txtPostalcode").val(), "MemberTypeId": 0, "Note": $('#txtNote').summernote('code'), "PhoneNumber": $("#txtPhoneNo").val(), "Email": $("#txtEmail").val(), "Password": $("#txtPassword").val(), "BusinessType": $("#ddlBusinessType").val(), "CityId": $("#ddlCity").val(), "AreaId": $("#ddlArea").val(), "CountryId": $("#ddlCountry").val(), "ManageYourBookings": 0, "ReasonForSigningUp": 0, "Website": $('#txtWebSite').val(), "GoogleMaps": '', "Image": response, "ImagePath": FilePath, "UpdatedBy": UpdatedBy, "FrontendStatus": 0, "SalonsId": $("#txtSalonsId").val(), "Noofchairs": $('#txtNoofchairs').val(), "Available": $('#lblAvailable').text(), "Popularity": $('#ddlPopularity').val(), "ClassId": $('#ddlClasses').val() },
                                type: "GET",
                                cache: false,
                                success: function (r) {
                                    $.ajax({
                                        url: URL + "api/emailTemplateTypes/SendEmail",
                                        data: { "Email": $('#txtEmail').val(), "Mobile": $('#txtPhoneNo').val(), "TemplateTypeId": 5, "Content": Content, "Name": $("#txtName").val() },
                                        type: "GET",
                                        cache: false,
                                        success: function (json) {

                                        }
                                    });
                                    if (r[0].Message == "UniqueConstraint") {
                                        $("#dvErrorStatus").css({ display: "block" });
                                        $("#lblSalon").text("Salons Name Already Existed.");
                                    }
                                    else if (r[0].Message == "Error") {
                                        $("#dvErrorStatus").css({ display: "block" });
                                        $('#lblSalon').text(r[0].ErrorMessage);
                                    }
                                    else {
                                        BindSalons();
                                        $("#dvErrorStatus").css({ display: "none" });
                                        //  $("#dvSuccess").css({ display: "block" });
                                        $("#myModal3").css('display', "block");
                                        $("#lblupdated").text("Details Updated Successfully");
                                        // $("#lbl_status").text("Salon Details Updated Successfully");
                                        //Clear();
                                        //StatusMessage(1);
                                    }
                                },
                                error: function (err) {
                                    $("#dvErrorStatus").css({ display: "block" });
                                    $('#lblSalon').text(err.statusText);
                                }
                            });
                        },
                        error: function (err) {
                            $("#dvErrorStatus").css({ display: "block" });
                            $('#lblSalon').text(err.statusText);
                        }
                    });
                }
                else {
                    var ImagePath = localStorage.getItem("EployeeProfileImage");
                    var Image = localStorage.getItem("Image");
                    if ($("#frontendStatus").is(':checked')) {
                        var i = 1;
                    }
                    else if (!$("#frontendStatus").is(':checked')) {
                        var i = 0;
                    }
                    var Content = "Your Salon As Updated. <br/> Your Salon Login Credentials are :<br/><br/> UserName : " + $('#txtEmail').val() + " <br/> Password :" + $('#txtPassword').val() + " ";
                    $.ajax({
                        url: URL + "api/Salons/UpdateSalons",
                        data: { "BusinessName": $("#txtBusinessName").val(), "Address": $("#txtAddress").val(), "Name": $("#txtName").val(), "PostalCode": $("#txtPostalcode").val(), "MemberTypeId": 0, "Note": $('#txtNote').summernote('code'), "PhoneNumber": $("#txtPhoneNo").val(), "Email": $("#txtEmail").val(), "Password": $("#txtPassword").val(), "BusinessType": $("#ddlBusinessType").val(), "CityId": $("#ddlCity option:selected").val(), "AreaId": $("#ddlArea option:selected").val(), "CountryId": $("#ddlCountry").val(), "ManageYourBookings": 0, "ReasonForSigningUp": 0, "Website": $('#txtWebSite').val(), "GoogleMaps": '', "Image": Image, "ImagePath": ImagePath, "UpdatedBy": UpdatedBy, "FrontendStatus": 0, "SalonsId": $("#txtSalonsId").val(), "Noofchairs": $('#txtNoofchairs').val(), "Available": $('#lblAvailable').text(), "Popularity": $('#ddlPopularity').val(), "ClassId": $('#ddlClasses').val() },
                        type: "GET",
                        cache: false,
                        success: function (r) {
                            $.ajax({
                                url: URL + "api/emailTemplateTypes/SendEmail",
                                data: { "Email": $('#txtEmail').val(), "Mobile": $('#txtPhoneNo').val(), "TemplateTypeId": 1, "Content": Content, "Name": $("#txtName").val() },
                                type: "GET",
                                cache: false,
                                success: function (json) {
                                    if (r[0].UserID == "Success") {
                                        $('#lblStatus').text("Successfully Registered, Check Your Email to Login");
                                        $("#lblStatus").css("color", "Green");
                                    } else {
                                        $('#lblStatus').text(r[0].UserID);
                                        $("#lblStatus").css("color", "Red");
                                    }
                                }
                            });
                            if (r[0].Message == "UniqueConstraint") {
                                $("#dvErrorStatus").css({ display: "block" });
                                $("#lblSalon").text("Salons Name Already Existed.");
                            }
                            else if (r[0].Message == "Error") {
                                $("#dvErrorStatus").css({ display: "block" });
                                $('#lblSalon').text(r[0].ErrorMessage);
                            }
                            else {
                                BindSalons();
                                // $("#dvErrorStatus").css({ display: "none" });
                                //  $("#dvSuccess").css({ display: "block" });
                                $("#myModal3").css('display', "block");
                                $("#lblupdated").text("Salon Details Updated Successfully");
                                //  $("#lbl_status").text("Details Updated Successfully");
                            }
                        },
                        error: function (err) {
                            $("#dvErrorStatus").css({ display: "block" });
                            $('#lblSalon').text(err.statusText);
                        }
                    });
                }

            }

        }
        else {
            if ($("#txtBusinessName").val() == '') {
                $("#dvErrorStatus").css({ display: "block" });
                $("#lblSalon").text("Please Enter Business Name");
                $("#txtBusinessName").focus();
            }

            else if ($('#ddlbookings').val() == 0) {
                $("#dvErrorStatus").css({ display: "block" });
                $("#lblSalon").text("Please Select bookings");
                $("#ddlbookings").focus();
            }
            else if ($('#ddlSigining').val() == 0) {
                $("#dvErrorStatus").css({ display: "block" });
                $("#lblSalon").text("Please Select Sigining");
                $("#ddlSigining").focus();
            }
            else if ($('#ddlCity').val() == 0) {
                $("#dvErrorStatus").css({ display: "block" });
                $("#lblSalon").text("Please Select City");
                $("#ddlCity").focus();
            }
            else if ($('#ddlArea').val() == 0) {
                $("#dvErrorStatus").css({ display: "block" });
                $("#lblSalon").text("Please Select Area");
                $("#ddlArea").focus();
            }
            else if ($("#txtEmail").val() == '') {
                $("#dvErrorStatus").css({ display: "block" });
                $("#lblSalon").text("Please Enter  Email");
                $("#txtEmail").focus();
            }
            else if ($("#txtPassword").val() == '') {
                $("#dvErrorStatus").css({ display: "block" });
                $("#lblSalon").text("Please Enter Password");
                $("#txtPassword").focus();
            }
            else if ($("#txtName").val() == '') {
                $("#dvErrorStatus").css({ display: "block" });
                $("#lblSalon").text("Please Enter  Name");
                $("#txtName").focus();
            } else if ($('#ddlClasses').val() == 0) {
                $("#dvErrorStatus").css({ display: "block" });
                $("#lblSalon").text("Please Select Class");
                $("#ddlClasses").focus();
            }
            else if ($('#txtNoofchairs').val() == "") {
                $("#dvErrorStatus").css({ display: "block" });
                $("#lblSalon").text("Please Enter No. of chairs");
                $("#txtNoofchairs").focus();
            }
        }
    }
    function GetClassesLoad(id) {
        $.ajax({
            type: 'GET',
            url: URL + "api/ClassesApi/GetClasses",
            contentType: 'application/x-www-form-urlencoded; charset=utf-8',
            cache: false,
            xhrFields: {
                withCredentials: false
            },
            success: function (data) {
                var tab = '';
                for (var i = 0; i < data.length; i++) {
                    if (data[i].Status == "1") {
                        tab += '<option value=' + data[i].ClassId + '>' + data[i].ClassName + '</option>';
                    }
                }
                $('#ddlClasses').append(tab);
                $('#ddlClasses').val(id);
            }
        });
    }
    function StatusMessage(value) {
        localStorage.setItem("SalonsMessage", value);
        window.location.href = '@Url.Action("SalonsList", "Salon")';
    }

    function GetAvailability() {
        var newchairs = $('#txtNoofchairs').val();
        var chairs = $('#txtNoofchairshidden').val();
        var bookedchairs = $('#txtbookedchairs').val();
        var available = $('#lblAvailable').text();
        var difference = newchairs - chairs;
        if (bookedchairs != 0) {
            if (difference >= 0 && available <= newchairs) {
                $('#lblAvailable').text(parseInt(difference) + parseInt(available));
                $('#lblAvailableStatus').text("");
            } else {
                $('#txtNoofchairs').val($('#txtNoofchairshidden').val());
                $('#lblAvailableStatus').text("Total chairs should be greater than or equal to available chairs");
            }
        } else {
            $('#lblAvailable').text(newchairs);
        }
    }

</script>
