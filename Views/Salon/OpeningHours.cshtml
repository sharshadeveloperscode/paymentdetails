
@{
    ViewBag.Title = "OpeningHours";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<div id="preloader" style="position: absolute; top: 0; left: 0; right: 0; bottom: 0; background-color: #fefefe; z-index: 99; height: 110vh;">
    <div id="status" style="width:100%;height:100%; text-align: center; position: absolute; left: 0; top: 30%; background-repeat: no-repeat; background-size: cover cover; background-position: center; margin: 0px 0 0 36px;">
        <div class="preloader-logo"></div>
        <p class="center-text smaller-text" id="p1" style="margin: 0 24px 10px !important;">
            <h2> Loading .. </h2><br />
            <img src="~/img/preload.gif" />
        </p>
    </div>
</div>
<section class="content-header">
    <h1>
        Business Hours

    </h1>
    <ol class="breadcrumb">
        <li><a href="#"><i class="fa fa-dashboard"></i> Home</a></li>
        <li><a href="#">Business Hours</a></li>
    </ol>
</section>
<section class="content">
    <div class="row">
        <div class="col-xs-12">
            <div class="box">

                <!-- /.box-header -->
                <div class="box-body table-responsive">
                    <div id="dvErrorStatus" style="display:none" class="alert alert-danger alert-dismissible">
                        <button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>
                        <label id="lblBusinessHours"></label>
                    </div>
                    <div id="dvSuccess" style="display:none" class="alert alert-success alert-dismissible">
                        <button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>
                        <label id="lbl_status"></label>
                        <label id="lblerror"></label>
                    </div>
                </div>

                <div class="box-body table-responsive">

                    <table style="width: 100%" class="table table-bordered table-hover dataTable">
                        <tr>

                            <th><h4>Day</h4></th>
                            <th><h4>Working Day</h4></th>
                            <th><h4>Opening Hours</h4></th>
                            <th><h4>Closing Hours</h4></th>
                        </tr>
                        <tr>
                            <td><label id="lbl0" style="margin-left: 1%;">Monday</label></td>
                            <td>
                                <select class="form-control" style="width:101px;" id="ddlWorking0" onchange="HideDates(0)">
                                    <option value="0">
                                        Non Working Day
                                    </option>
                                    <option value="1">
                                        Working Day
                                    </option>
                                </select>
                            </td>
                            <td>
                                <select class="form-control" style="width:101px;" id="ddlOpeningHours0"></select>
                            </td>
                            <td>
                                <select class="form-control" style="width:101px;" id="ddlClosingHours0"></select>

                        </tr>
                        <tr>
                            <td><label id="lbl1">Tuesday</label></td>
                            <td>
                                <select class="form-control" style="width:101px;" onchange="HideDates(1)" id="ddlWorking1">
                                    <option value="0">
                                        Non Working Day
                                    </option>
                                    <option value="1">
                                        Working Day
                                    </option>
                                </select>
                            </td>
                            <td>
                                <select class="form-control" style="width:101px;" id="ddlOpeningHours1"></select>
                            </td>
                            <td>
                                <select class="form-control" style="width:101px;" id="ddlClosingHours1"></select>

                        </tr>
                        <tr>
                            <td><label id="lbl2">Wednesday</label></td>
                            <td>
                                <select class="form-control" style="width:101px;" onchange="HideDates(2)" id="ddlWorking2">
                                    <option value="0">
                                        Non Working Day
                                    </option>
                                    <option value="1">
                                        Working Day
                                    </option>
                                </select>
                            </td>
                            <td>
                                <select class="form-control" style="width:101px;" id="ddlOpeningHours2"></select>
                            </td>
                            <td>
                                <select class="form-control" style="width:101px;" id="ddlClosingHours2"></select>

                        </tr>
                        <tr>
                            <td><label id="lbl3">Thursday</label></td>
                            <td>
                                <select class="form-control" style="width: 101px;" onchange="HideDates(3)" id="ddlWorking3">
                                    <option value="0">
                                        Non Working Day
                                    </option>
                                    <option value="1">
                                        Working Day
                                    </option>
                                </select>
                            </td>
                            <td>
                                <select class="form-control" style="width:101px;" id="ddlOpeningHours3"></select>
                            </td>
                            <td>
                                <select class="form-control" style="width: 101px;" id="ddlClosingHours3"></select>

                        </tr>
                        <tr>
                            <td><label id="lbl4">Friday</label></td>
                            <td>
                                <select class="form-control" style="width: 101px;" onchange="HideDates(4)" id="ddlWorking4">
                                    <option value="0">
                                        Non Working Day
                                    </option>
                                    <option value="1">
                                        Working Day
                                    </option>
                                </select>
                            </td>
                            <td>
                                <select class="form-control" style="width: 101px;" id="ddlOpeningHours4"></select>
                            </td>
                            <td>
                                <select class="form-control" style="width: 101px;" id="ddlClosingHours4"></select>

                        </tr>
                        <tr>
                            <td><label id="lbl5">Saturday</label></td>
                            <td>
                                <select class="form-control" style="width: 101px;" onchange="HideDates(5)" id="ddlWorking5">
                                    <option value="0">
                                        Non Working Day
                                    </option>
                                    <option value="1">
                                        Working Day
                                    </option>
                                </select>
                            </td>
                            <td>
                                <select class="form-control" style="width: 101px;" id="ddlOpeningHours5"></select>
                            </td>
                            <td>
                                <select class="form-control" style="width: 101px;" id="ddlClosingHours5"></select>

                        </tr>
                        <tr>
                            <td><label id="lbl6">Sunday</label></td>
                            <td>
                                <select class="form-control" style="width:101px;" onchange="HideDates(6)" id="ddlWorking6">
                                    <option value="0">
                                        Non Working Day
                                    </option>
                                    <option value="1">
                                        Working Day
                                </select>
                            </td>
                            <td>
                                <select class="form-control" style="width: 101px;" id="ddlOpeningHours6"></select>
                            </td>
                            <td>
                                <select class="form-control" style="width: 101px;" id="ddlClosingHours6"></select>
                        </tr>
                    </table>
                    <div style="text-align:right; margin-top: 10px;">
                        <input type="button" class="btn btn-primary" id="btnSave" value="Save" style="width:100px;" onclick="Save()" />

                        <input type="button" class="btn btn-primary" id="btnUpdate" value="Update" style="width:100px;" onclick="Update()" />
                        @*<input type="button" class="btn btn-danger" id="btnReset" value="Reset" onclick="Clear()" style="width:100px;">*@
                        <input type="button" class="btn btn-danger" id="btnBack" value="Back" style="width:100px;" onclick="window.location.href='@Url.Action("BusinessDashboard", "Salon")';" />
                        <input type="text" id="txtSalonsId" hidden />
                        <input type="text" id="txtBusinessHoursId" hidden />
                    </div>

                    <label id="lbl_status"></label>
                </div>
            </div>
        </div>
    </div>
</section>

<script type="text/javascript">
    var BusinessHoursId = [];
    window.onload = function () {
        OpeningHours();
        ClosingHours();
        disabledates();
        $('#btnSave').show();
        $('#btnUpdate').hide();


        @*if (UserId != "null" || UserId != null && RoleId == "1") {
             var EditManageYourBookingsId = localStorage.getItem("EditManageYourBookingsId");
             if (EditManageYourBookingsId == "null") {
                 $('#btnEdit').hide();
                 $('#btnSave').show();
             }
             else {

                 BindManageYourBookings(EditManageYourBookingsId);
                 $('#btnEdit').show();
                 $('#btnSave').hide();
                 $('#btnReset').hide();
             }

         }
         else {
             window.location.href = '@Url.Action("Logout", "Salon")';
         }*@
    }
    function disabledates() {

        for (var i = 0; i < 7; i++) {
            if ($('#ddlWorking' + i).val() == 0) {
                $('#ddlOpeningHours' + i).val(1);
                $('#ddlClosingHours' + i).val(1);
                $('#ddlOpeningHours' + i).attr('disabled', true);
                $('#ddlClosingHours' + i).attr('disabled', true);

            } else if ($('#ddlWorking' + i).val() == 1) {
                $('#ddlOpeningHours' + i).attr('disabled', false);
                $('#ddlClosingHours' + i).attr('disabled', false);

            }
        }
    }
    function HideDates(i) {
        if ($('#ddlWorking' + i).val() == 0) {
            $('#ddlOpeningHours' + i).val(1);
            $('#ddlClosingHours' + i).val(1);
            $('#ddlOpeningHours' + i).attr('disabled', true);
            $('#ddlClosingHours' + i).attr('disabled', true);
            //  Update();
        } else if ($('#ddlWorking' + i).val() == 1) {
            $('#ddlOpeningHours' + i).attr('disabled', false);
            $('#ddlClosingHours' + i).attr('disabled', false);


        }
    }
    function BindSalons() {
        $.ajax({
            type: "GET",
            url: URLLink + "api/Salons/GetSalonIdByUserId",
            data: { "UserId": UserId },
            cache: false,
            success: function (json) {
                var SalonsId = json[0].SalonsId;

                $.ajax({
                    type: "GET",
                    url: URLLink + "api/BusinessHours/GetDatabySalonId",
                    data: { "SalonsId": SalonsId },
                    cache: false,
                    async: false,
                    success: function (r) {
                        $('#preloader').hide();
                        if (r[0].Message == "Success") {
                            $('#btnSave').hide();
                            $('#btnUpdate').show();
                            $("#btnReset").hide();
                            $('#txtSalonsId').val(r[0].SalonsId);

                            for (var M = 0; M < r.length ; M++) {
                                BusinessHoursId.push(r[M].BusinessHoursId);
                                //alert(BusinessHoursId[M]);
                                $("#lbl" + M).text(r[M].Day);
                                $("#ddlOpeningHours" + M).val(r[M].OpeningHours);
                                $("#ddlClosingHours" + M).val(r[M].ClosingHours);

                                $("#ddlWorking" + M).val(r[M].IsActive);
                                HideDates(M);
                            }
                        }
                        else {
                            $('#btnSave').show();
                            $('#btnUpdate').hide();
                        }
                    }
                });
            }
        });
    }

    function Update() {
        var valid = 0;
        for (var j = 0; j <= 7 ; j++) {
            if ($("#ddlWorking" + j).val() == 1) {
                if (($("#ddlOpeningHours" + j + " option:selected").text()) >= ($("#ddlClosingHours" + j + " option:selected").text())) {
                    var Day = $("#lbl" + j + "").text();
                    id = 1;
                    valid = 1;

                    $("#myModal6").css('display', "block");
                    $("#lblupdated1").text("Closing hours should be after opening hours  " + Day);
                    //  alert("Please Select Closing hours is greater than Opening hours of your salon for  " + Day);
                }
            }
        }

        var id = 0;
        for (var j = 0; j <= 7 ; j++) {
            if ($("#ddlWorking" + j).val() == 1 || $("#ddlWorking" + j).val() == 0) {


                //if (($("#ddlOpeningHours" + j + " option:selected").text()) >= ($("#ddlClosingHours" + j + " option:selected").text()) && valid==1 ) {
                //    var Day = $("#lbl" + j + "").text();
                //    id = 1;


                //    $("#myModal6").css('display', "block");
                //    $("#lblupdated1").text("Please Select Closing hours is greater than Opening hours of your salon for  " + Day);
                //  //  alert("Please Select Closing hours is greater than Opening hours of your salon for  " + Day);
                //}
                if (id == 0 && valid == 0) {
                    var OpiningHours = "";
                    var ClosingHours = "";


                    if ($("#ddlWorking" + j).val() == 0) {

                        OpiningHours = "1";
                        ClosingHours = "1";
                    }
                    else if ($("#ddlWorking" + j).val() == 1) {


                        OpiningHours = $("#ddlOpeningHours" + j).val();
                        ClosingHours = $("#ddlClosingHours" + j).val();

                    }
                    var BusinessHoursdId = BusinessHoursId[j];

                    $.ajax({
                        type: "GET",
                        // Update(int SalonsId, string Day, int OpeningHours, int ClosingHours, int UpdatedBy, int BusinessHoursId)
                        url: URLLink + "api/BusinessHours/Update",
                        data: { "SalonsId": $('#txtSalonsId').val(), Day: $("#lbl" + j).text(), "OpeningHours": OpiningHours, "ClosingHours": ClosingHours, "IsActive": $("#ddlWorking" + j).val(), "UpdatedBy": UserId, "BusinessHoursId": BusinessHoursdId },
                        cache: false,
                        async: false,
                        success: function (r) {

                            if (r[0].Message == "Success") {
                                //   $("#dvErrorStatus").css({ display: "none" });
                                //  $("#dvSuccess").css({ display: "block" });
                                // $("#lbl_status").text("Business Hours Updated Successfully");
                                $("#myModal3").css('display', "block");
                                $("#lblupdated").text("Business Hours Updated Successfully");
                            }
                            else if (r[0].Message == "Error") {
                                $('#lblMessage').text(r[0].ErrorMessage);
                            }
                        },
                        error: function () {
                            $("#dvErrorStatus").css({ display: "block" });
                            $('#lblError').text(err.statusText);
                        }
                    })
                }

            }
        }



    }




    function OpeningHours() {

        $.ajax({
            type: 'GET',
            url: URLLink + "api/StartTime/GetData",
            contentType: 'application/x-www-form-urlencoded; charset=utf-8',
            cache: false,
            xhrFields: {
                withCredentials: false
            },
            success: function (data) {
                $('#preloader').hide();
                for (var i = 0; i < data.length; i++) {
                    var opt = new Option(data[i].StartTime, data[i].StartTimeId);
                    var opt1 = new Option(data[i].StartTime, data[i].StartTimeId);
                    var opt2 = new Option(data[i].StartTime, data[i].StartTimeId);
                    var opt3 = new Option(data[i].StartTime, data[i].StartTimeId);
                    var opt4 = new Option(data[i].StartTime, data[i].StartTimeId);
                    var opt5 = new Option(data[i].StartTime, data[i].StartTimeId);
                    var opt6 = new Option(data[i].StartTime, data[i].StartTimeId);
                    $("#ddlOpeningHours0").val("") && $("#ddlOpeningHours1").val("") && $("#ddlOpeningHours2").val("") && $("#ddlOpeningHours3").val("") && $("#ddlOpeningHours4").val("") && $("#ddlOpeningHours5").val("") && $("#ddlOpeningHours6").val("");
                    $('#ddlOpeningHours0').append(opt) && $('#ddlOpeningHours1').append(opt1) && $('#ddlOpeningHours2').append(opt2) && $('#ddlOpeningHours3').append(opt3) && $('#ddlOpeningHours4').append(opt4) && $('#ddlOpeningHours5').append(opt5) && $('#ddlOpeningHours6').append(opt6);
                }
            }
        })
    }

    function ClosingHours() {
        $.ajax({
            type: 'GET',
            url: URLLink + "api/EndTime/GetData",
            contentType: 'application/x-www-form-urlencoded; charset=utf-8',
            cache: false,
            xhrFields: {
                withCredentials: false
            },
            success: function (data) {
                for (var i = 0; i < data.length; i++) {
                    var opt = new Option(data[i].EndTime, data[i].EndTimeId);
                    var opt1 = new Option(data[i].EndTime, data[i].EndTimeId);
                    var opt2 = new Option(data[i].EndTime, data[i].EndTimeId);
                    var opt3 = new Option(data[i].EndTime, data[i].EndTimeId);
                    var opt4 = new Option(data[i].EndTime, data[i].EndTimeId);
                    var opt5 = new Option(data[i].EndTime, data[i].EndTimeId);
                    var opt6 = new Option(data[i].EndTime, data[i].EndTimeId);
                    $("#ddlClosingHours0").val("") && $("#ddlClosingHours1").val("") && $("#ddlClosingHours2").val("") && $("#ddlClosingHours3").val("") && $("#ddlClosingHours4").val("") && $("#ddlClosingHours5").val("") && $("#ddlClosingHours6").val("");
                    $('#ddlClosingHours0').append(opt) && $('#ddlClosingHours1').append(opt1) && $('#ddlClosingHours2').append(opt2) && $('#ddlClosingHours3').append(opt3) && $('#ddlClosingHours4').append(opt4) && $('#ddlClosingHours5').append(opt5) && $('#ddlClosingHours6').append(opt6);
                }
                BindSalons();
            }
        })
    }





    function Save() {
        var valid = 0;
        for (var j = 0; j <= 7 ; j++) {
            if ($("#ddlWorking" + j).val() == 1) {
                if (($("#ddlOpeningHours" + j + " option:selected").text()) >= ($("#ddlClosingHours" + j + " option:selected").text())) {
                    var Day = $("#lbl" + j + "").text();
                    id = 1;
                    valid = 1;

                    $("#myModal6").css('display', "block");
                    $("#lblupdated1").text("Closing hours should be after opening hours " + Day);
                }
            }
        }
        if (valid == 0) {
            $('#preloader').show();
            $.ajax({
                type: "GET",
                url: URLLink + "api/Salons/GetSalonIdByUserId",
                data: { "UserId": UserId },
                cache: false,
                success: function (json) {
                    var SalonsId = json[0].SalonsId;
                    var OpiningHours = "";
                    var ClosingHours = "";
                    for (var i = 0; i < 7; i++) {
                        if ($("#ddlWorking" + i).val() == "0") {
                            OpiningHours = "1";
                            ClosingHours = "1";
                        }
                        else {
                            OpiningHours = $("#ddlOpeningHours" + i).val();
                            ClosingHours = $("#ddlClosingHours" + i).val();
                        }
                        $.ajax({
                            type: "GET",
                            url: URLLink + "api/BusinessHours/Insert",
                            data: { "SalonsId": SalonsId, Day: $("#lbl" + i).text(), "OpeningHours": OpiningHours, "ClosingHours": ClosingHours, IsAcitve: $("#ddlWorking" + i).val(), CreatedBy: UserId },
                            cache: false,
                            async: false,
                            success: function (r) {
                                if (r[0].Message == "Success") {
                                    //   $("#dvErrorStatus").css({ display: "none" });
                                    //   $("#dvSuccess").css({ display: "block" });
                                    //  $("#lbl_status").text(" Business Hours Added Successfully");
                                    $("#myModal3").css('display', "block");
                                    $("#lblupdated").text("Business Hours added Successfully");
                                    BindSalons();
                                }
                                else if (r[0].Message == "Error") {
                                    $('#lblMessage').text(r[0].ErrorMessage);
                                }
                            },
                            error: function () {
                                $("#dvErrorStatus").css({ display: "block" });
                                $('#lblError').text(err.statusText);
                            }
                        })
                    }

                },
                error: function () {

                }
            })
        }
    }
</script>

